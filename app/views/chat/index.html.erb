<!DOCTYPE html>
<head>
	<style>
	input {
		width: 95%;
		border-radius: 10px;
	}

	li {
		cursor: default;
	}

	ul {
		list-style-type: none;
		padding: 0;
		margin: 0;
	}

	.toolbar div {
		margin-right: 5px;
		margin-top: 5px;
		float: right;
    width: 20px;
		height: 20px;
		background-color: black;
		color: white;

	}

	.toolbar div p {
	  margin-top: 1px;
		text-align: center;
	}

	.toolbar {
		width: 100%;
		height: 30px;
		background-color: grey;
	}
	body {
		overflow: hidden;
		max-width:100%;
		max-height: 100%;
		min-height: 100%;
		min-width: 100%;
		width: 100%;
		height: 1000px;
	}

	.chats {
		height: 100%;
	}

	.container {
		overflow: hidden;
		max-width:100%;
		max-height: 100%;
		min-height: 100%;
		min-width: 100%;
		width: 100%;
		height: 100%;
	}

	.smallbox {
    float: left;
		border: 2px solid black;
		height: 30px;
		width: 20%;
		min-height: 5%;
		min-width: 15%;
		max-width: 30%;
		overflow: hidden;
		background-color: turquoise;
		border-radius: 10px;
	}

	.bigbox {
		position: absolute;
    float: left;
		border: 2px solid black;
		height: 800px;
		width: 99%;
		overflow: hidden;
		background-color: turquoise;
		border-radius: 10px;
	}

	.box {
    float: left;
		border: 2px solid black;
		height: 10%;
		width: 20%;
		min-height: 5%;
		min-width: 15%;
		max-width: 30%;
		overflow: hidden;
		background-color: turquoise;
		border-radius: 10px;
	}
	</style>
  <title>Pusher Test</title>
	<link rel="stylesheet" src="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css">
  <script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js" type="text/javascript"></script>
	<script src="http://js.pusher.com/2.0/pusher.min.js" type="text/javascript"></script>
  <script src='http://code.jquery.com/jquery-1.9.1.js' type="text/javascript">
	</script>
	<script src="http://underscorejs.org/underscore.js" type="text/javascript"></script>

</head>

<body>
<div class="container">
	<div id="users">
	</div>
	<div id="chats">
	</div>
</div>
</body>
  <script type="text/javascript">
		$(function() {
			// Enable pusher logging - don't include this in production
	    Pusher.log = function(message) {
	      if (window.console && window.console.log) window.console.log(message);
	    };

	    // Flash fallback logging - don't include this in production
	    WEB_SOCKET_DEBUG = true;

	    var pusher = new Pusher('59f43f1f5867e554bcfb');

      CA.onlineUsers = pusher.subscribe('presence-online')
			CA.onlineUsers.bind('pusher:subscription_succeeded', function(members){
				CA.users = members;
				CA.usersView.render();
			});
			CA.onlineUsers.bind('pusher:member_added', function(member) {
			  CA.usersView.render();
			});
			CA.onlineUsers.bind('pusher:member_removed', function(member) {
			  CA.usersView.render();
			});
			CA.onlineUsers.bind('client-receive_message', function(data) {
				if ( data['target'] == CA.users.me.info.name ) {
					var user = data['user'];
					var message = data['message'];
					CA.chats[user] ? '' : CA.chats[user] = [] ;
				  CA.chats[user].push(user + ': ' + message);
	        CA.chatsView.render();
				}
			});


			CA.chatsView = new CA.Views.ChatsView({el: $('#chats')})
			CA.usersView = new CA.Views.UsersView({el: $('#users')})
		});
  </script>

